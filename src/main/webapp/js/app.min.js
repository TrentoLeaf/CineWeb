(function(){function a(a,b,f,d){$("#svg-theatre").empty();var e=a.length,g=a[0].length,l=55*g+100,r=55*e+110,v=680*l/650,y=15*v/680;$("#svg-theatre").attr({width:"100%",height:"100%"});var u=Snap("#svg-theatre");u.attr({viewBox:"0 0 "+v+" "+(165+r)});var m=Snap.fragment("<g class='stage'><polygon class='stage_floor' points='675,0 5,0 0,140 680,140'/><polygon class='stage_step' points='665,165 15,165 0,140 680,140'/><g class='stage_screen'><path class='stage_screen_display' d='M531,105c-0.9,2.5-2.5,5-5.6,5H154.9c-3.1,0-5-2.5-5.6-5L115,35h450L531,105z'/><path class='stage_screen_depth' d='M565,35c0-2.8-2.5-5-5.6-5H120.6c-3.1,0-5.6,2.2-5.6,5l0,0c0,2.8,2.5,5,5.6,5h438.8 C562.5,40,565,37.8,565,35L565,35z'/></g></g>"),
q=Snap.fragment("<rect x='0' y='0' class='theatre' width='650' height='385'/>"),z=Snap.fragment("<g class='seat'><rect x='0' y='0' class='seat_rectangle' width='55' height='55'/><g class='seat_armchair'><path class='seat_back' d='M44.2,41.8c0,2.3-0.5,4.7-1.4,5.7H12.2c-0.9-1-1.4-3.3-1.4-5.7c0-2.3,0.5-4.6,1.4-5.6h30.6 c0.2,0.2,0.3,0.4,0.5,0.7c0.1,0.3,0.3,0.6,0.4,0.9c0.1,0.4,0.3,1,0.4,1.5C44.2,40.1,44.2,41,44.2,41.8z'/><path class='seat_arm' d='M12.2,10.7c-2.4-0.6-6-0.2-7.2,1v20.4c0,10.1,5.8,9.8,5.8,9.8c0-2.3,0.5-4.6,1.4-5.6h2V11.7\tC13.8,11.3,13.1,10.9,12.2,10.7z'/><path class='seat_arm' d='M42.8,10.7c-0.9,0.2-1.6,0.6-2,1v24.5h2c0.2,0.2,0.3,0.4,0.5,0.7c0.1,0.3,0.3,0.6,0.4,0.9 c0.1,0.5,0.3,0.9,0.4,1.5c0.1,0.8,0.2,1.7,0.2,2.5c0,0,5.8,0.3,5.8-9.8V11.7C48.8,10.5,45.2,10.1,42.8,10.7z'/><path class='seat_sitting' d='M42.8,10.5v0.2c-0.9,0.2-1.6,0.6-2,1v24.5H14.2V11.7c-0.4-0.5-1.1-0.8-2-1v-0.2C17.6,6.5,37.4,6.5,42.8,10.5z'/></g></g>"),
A=Snap.fragment("<g class='theatre_row_header'><rect x='0' y='0' class='theatre_row_header_rectangle' width='50' height='55'/><text x='25' y='35' class='theatre_row_header_text'>A</text></g>"),B=Snap.fragment("<g class='theatre_column_header'><rect x='0' y='0' class='theatre_column_header_rectangle' width='55' height='50'/><text x='27.5' y='33' class='theatre_column_header_text'>1</text></g>"),m=m.select(".stage"),q=q.select(".theatre"),z=z.select(".seat"),A=A.select(".theatre_row_header"),B=B.select(".theatre_column_header");
m.transform("s"+v/680+",1");q.attr({width:l,height:r,x:y,y:165});u.append(m);u.append(q);l=y;r=225;q=String.fromCharCode("A".charCodeAt()-1);for(m=v=0;m<e;m++){var p=A.clone();p.transform("t"+l+","+r);q="Z"==q?"A":String.fromCharCode(q.charCodeAt()+1);p.select("text").attr({text:q});u.append(p);l+=50;for(p=0;p<g;p++){var w=z.clone();w.transform("t"+l+","+r);w.attr({row:m.toString()});w.attr({col:p.toString()});c(w,a[m][p],b,f,d);0!=a[m][p]&&u.append(w);0==a[m][p]&&d&&u.append(w);l+=55}r+=55;l=y}l+=
50;for(m=0;m<g;m++)a=B.clone(),a.transform("t"+l+","+r),v++,a.select("text").attr({text:v}),u.append(a),l+=55;$(".tooltipped").tooltip({delay:300})}function c(a,c,n,k,x){switch(c){case 1:void 0!=n?(a.hover(b,f),a.click(function(){if(this.hasClass("seat-selected")){var d={row:a.attr("row"),col:a.attr("col")};g(d,k);this.removeClass("seat-selected");this.hover(b,f);n.seats_selected++}else 0<n.seats_selected&&(k.push({row:a.attr("row"),col:a.attr("col")}),n.seats_selected--,this.addClass("seat-selected"),
this.removeClass("seat-hover"),this.unhover(b,f))})):x&&(a.attr({cursor:"url(../img/cursors/hammer.png), default"}),d(a),a.click(function(){if(this.hasClass("seat-hidden")){var b={row:a.attr("row"),col:a.attr("col")};g(b,k);this.removeClass("seat-hidden");a.attr({cursor:"url(../img/cursors/hammer.png), default"})}else k.push({row:a.attr("row"),col:a.attr("col")}),this.addClass("seat-hidden"),a.attr({cursor:"url(../img/cursors/hotseat.png), default"})}));break;case 2:a.addClass("seat-unavailable");
break;case 3:a.addClass("seat-best");break;case 0:x&&(a.addClass("seat-hidden"),k.push({row:a.attr("row"),col:a.attr("col")}),a.attr({cursor:"url(../img/cursors/hotseat.png), default"}),d(a),a.click(function(){if(this.hasClass("seat-hidden")){var b={row:a.attr("row"),col:a.attr("col")};g(b,k);this.removeClass("seat-hidden");a.attr({cursor:"url(../img/cursors/hammer.png), default"})}else k.push({row:a.attr("row"),col:a.attr("col")}),this.addClass("seat-hidden"),a.attr({cursor:"url(../img/cursors/hotseat.png), default"})}))}a.addClass("tooltipped");
c=e(parseInt(a.attr("row")));x=parseInt(a.attr("col"))+1;a.attr("data-position","top");a.attr("data-tooltip",c+x)}function e(a){return String.fromCharCode("A".charCodeAt()+parseInt(a))}function b(){this.addClass("seat-hover")}function f(){this.removeClass("seat-hover")}function d(a){a.mousedown(function(){-1!=a.attr("cursor").indexOf("hammer")&&a.attr({cursor:"url(../img/cursors/hammer_down.png), default"})});a.mouseup(function(){-1!=a.attr("cursor").indexOf("hammer")&&a.attr({cursor:"url(../img/cursors/hammer.png), default"})})}
function g(a,b){for(var f=0;f<b.length;f++)a.row==b[f].row&&a.col==b[f].col&&(b.splice(f,1),f=b.length)}angular.module("mapModule",[]).directive("map",function(){return{restrict:"E",template:'<div id="svg-container"><svg id="svg-theatre"></svg></div>',scope:{o:"=o"},link:function(b,f,d){b.$watch("o.film.seats",function(f){void 0!=b.o.film&&void 0!=b.o.film.seats&&void 0!=b.o.selected_seats&&a(b.o.film.seats,b.o.film,b.o.selected_seats,!1)},!0);b.$watch("o.mapTheatre",function(f){void 0!=b.o.mapTheatre&&
void 0!=b.o.editable&&(b.o.editable?a(b.o.mapTheatre,void 0,b.o.selected_seats,!0):a(b.o.mapTheatre,void 0,void 0,!1))},!0)}}})})();(function(){angular.module("buyProcedureModule",["constantsModule"]).factory("BuyProcedure",["BASE","$http",function(a,c){var e=a+"/buy/proceed",b=a+"/buy/pay";return{proceed:function(a){return c.post(e,{cart:a})},pay:function(a,d){return c.post(b,{creditCard:a,cart:d})}}}])})();(function(){angular.module("constantsModule",[]).constant("BASE","/api")})();(function(){Array.prototype.toMap=function(a){var c={};this.forEach(function(e){c[e[a]]=e});return c};Array.prototype.toArrayMap=function(a){var c={};this.forEach(function(e){c[e[a]]=c[e[a]]||[];c[e[a]].push(e)});return c};angular.module("filmsPlaysModule",["constantsModule","ngResource"]).factory("Films",["BASE","$resource",function(a,c){return c(a+"/films/:id",{id:"@id"},{update:{method:"PUT"}})}]).factory("Plays",["BASE","$resource",function(a,c){return c(a+"/plays/:id",{id:"@id"},{update:{method:"PUT"}})}]).factory("CompletePlays",
["BASE","Films","$http","$q",function(a,c,e,b){return{playsByDate:function(){var f=b.defer(),d=e.get(a+"/films/future"),c=e.get(a+"/plays/future");b.all([d,c]).then(function(a){function b(a,f){var d=new Date(a.time),c=new Date(f.time);return d<c?-1:d>c?1:0}var d=a[0].data.toMap("fid"),c=[];a=a[1].data.map(function(a){a.date=a.time.split("T")[0];return a}).toArrayMap("date");for(var e in a)a.hasOwnProperty(e)&&c.push({date:e,films:a[e]});c.forEach(function(a){var f=a.films.toArrayMap("fid");a.films=
[];for(var c in f)if(f.hasOwnProperty(c)){var e=angular.copy(d[c]);e.plays=f[c];e.plays.map(function(a){delete a.fid;delete a.date;return a});e.plays.sort(b);e.date=a.date;a.films.push(e)}});c.sort(function(a,b){var f=new Date(a.date),c=new Date(b.date);return f<c?-1:f>c?1:0});f.resolve(c)},function(a){f.reject(a)});return f.promise}}}])})();(function(){angular.module("pricesModule",["constantsModule","ngResource"]).factory("Prices",["BASE","$http",function(a,c){var e=a+"/prices/";return{save:function(a){return c.post(e,a)},update:function(a){return c.put(e+a.type,a)},"delete":function(a){return c["delete"](e+a.type)},getList:function(){return c.get(e)}}}])})();(function(){angular.module("roomsModule",["constantsModule","ngResource"]).factory("Theatre",["BASE","$resource",function(a,c){return c(a+"/rooms",{addRoom:{method:"POST"}})}]).factory("Rooms",["BASE","$http",function(a,c){var e=a+"/rooms",b=a+"/plays";return{getRoomsOnly:function(){return c.get(e)},getRoomEditableByID:function(a){return c.get(e+"/"+a)},getRoomTopByID:function(a){return c.get(e+"/"+a+"/top")},getRoomStatus:function(a){return c.get(b+"/"+a+"/room")},editRoom:function(a,b){return c.put(e+
"/"+a,b)}}}])})();(function(){angular.module("statsModule",["constantsModule","ngResource"]).factory("Stats",["BASE","$http",function(a,c){var e=a+"/users",b=a+"/films";return{topUsers:function(){return c.get(e+"/top")},grossingFilms:function(){return c.get(b+"/grossing")}}}])})();(function(){angular.module("storageModule",["angular-locker"]).factory("StorageService",["locker",function(a){return{saveCart:function(c){a.put("cart",JSON.stringify(c))},cleanCart:function(){a.forget("cart")},loadCart:function(){var c=a.get("cart",null);return JSON.parse(c)}}}])})();(function(){angular.module("usersModule",["constantsModule","ngResource"]).factory("Users",["BASE","$resource",function(a,c){return c(a+"/users/:id",{id:"@id"},{update:{method:"PUT"}})}]).factory("Auth",["BASE","$http","$q","$templateCache",function(a,c,e,b){var f=a+"/users",d=a+"/bookings",g=a+"/tickets";return{login:function(a,b){var d=e.defer();c.post(f+"/login",{email:a,password:b}).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)});return d.promise},logout:function(){return c.post(f+
"/logout").success(function(){b.removeAll()})},changePassword:function(a,b,d){return c.post(f+"/change-password",{email:a,oldPassword:b,newPassword:d})},changePasswordWithCode:function(a,b,d){return c.post(f+"/change-password-code",{email:a,code:b,newPassword:d})},registration:function(a,b,d,e){return c.post(f+"/registration",{email:a,password:b,firstName:d,secondName:e})},confirmRegistration:function(a){return c.post(f+"/confirm",{code:a})},forgotPassword:function(a){return c.post(f+"/forgot-password",
{email:a})},me:function(){var a=e.defer();c.get(f+"/me").success(function(b){a.resolve(b)}).error(function(b,f){a.reject(b)});return a.promise},my_bookings:function(){return c.get(d+"/my")},user_bookings:function(a){return c.get(d+"/"+a)},deleteTicket:function(a){return c["delete"](g+"/"+a)}}}])})();(function(){angular.module("adminDashboard",["constantsModule"]).controller("AdminDashboardController",["BASE","$http",function(a,c){var e=this;this.result="";this.loadSampleData=function(){$(".data-loader").addClass("active");this.result="CARICAMENTO...";c.post(a+"/load-example-data").success(function(a){$(".data-loader").removeClass("active");e.result="CARICAMENTO...OK"}).error(function(a){$(".data-loader").removeClass("active");e.result="ERRORE"})}}])})();(function(){angular.module("adminFilms",["filmsPlaysModule"]).controller("AdminFilmsEditController",["$routeParams","$location","Films",function(a,c,e){var b=this;this.currentFilm={};this.status="";this.error_message=!1;e.get({id:a.fid}).$promise.then(function(a){b.currentFilm=a},function(){c.path("/admin/films")});this.save=function(){e.update({id:b.currentFilm.fid},b.currentFilm).$promise.then(function(a){c.path("/admin/films")},function(a){b.error_message=!0;b.setStatus("Qualcosa \u00e8 andato storto, riprova");
$("html, body").animate({scrollTop:0},"fast")})};this.setStatus=function(a){b.setStatusClass();b.status=a};this.setStatusClass=function(){b.error_message?($("#film_edit_message").removeClass("green-text white-text"),$("#film_edit_message").addClass("red-text")):($("#film_edit_message").removeClass("red-text white-text"),$("#film_edit_message").addClass("green-text"))}}]).controller("AdminFilmsController",["$rootScope","$location","Films",function(a,c,e){var b=this;this.loading=!0;this.films=[];this.newFilm=
new e;this.status="";this.error_message=!1;this.loadFilms=function(){b.films=[];e.query(function(a){b.films=a;b.loading=!1},function(){b.error_message=!0;b.setStatus("Errore durante il caricamento dei film")})};this.addFilm=function(){b.newFilm.$save(function(a){b.films.push(a);b.newFilm=new e;c.path("/admin/films")},function(a){409==a.status?(b.error_message=!0,b.setStatus("Film gi\u00e0 esistente")):400==a.status?(b.error_message=!0,b.setStatus("Controlla i dati inseriti")):(b.error_message=!0,
b.setStatus("Qualcosa \u00e8 andato storto, riprova"));$("html, body").animate({scrollTop:0},"fast")})};this.deleteFilm=function(){e["delete"]({id:b.tmpFilm.fid},function(){b.error_message=!1;b.setStatus("Film cancellato con successo");$("html, body").animate({scrollTop:0},"fast")},function(a){409==a.status?(b.error_message=!0,b.setStatus("Impossibile cancellare il film, \u00e8 attualmente in proiezione")):400==a.status?(b.error_message=!0,b.setStatus("Impossibile procedere alla cancellazione, film non trovato")):
(b.error_message=!0,b.setStatus("Qualcosa \u00e8 andato storto, riprova"));$("html, body").animate({scrollTop:0},"fast")})};this.open_modal=function(a){this.tmpFilm=this.films[a];$("#modal_film_delete").openModal()};this.close_modal=function(){$("#modal_film_delete").closeModal()};this.setStatus=function(a){b.setStatusClass();b.status=a};this.setStatusClass=function(){b.error_message?($("#film_message").removeClass("green-text white-text"),$("#film_message").addClass("red-text")):($("#film_message").removeClass("red-text white-text"),
$("#film_message").addClass("green-text"))};this.loadFilms()}])})();(function(){angular.module("adminPlays",["filmsPlaysModule"]).controller("AdminNewPlaysController",["Films","$rootScope","$scope","$location","Plays",function(a,c,e,b,f){var d=this;this.status="";this.error_message=!1;this.newPlay=new f;this.newPlay_3d=!1;this.films=[];this.date="";this.time="21:00";this.loadFilms=function(){a.query(function(a){d.films=a},function(){d.error_message=!0;d.setStatus("Errore durante il caricamento dei film")})};this.addPlay=function(a){d.newPlay.time=new Date(d.date+
" "+d.time);d.newPlay._3d=d.newPlay_3d?!0:!1;d.newPlay.$save(function(a){d.newPlay=new f;d.updatePlays();b.path("/admin/plays")},function(a){409==a.status?(d.error_message=!0,d.setStatus("Esiste gi\u00e0 una proiezione in questa sala per questo preciso orario")):400==a.status?(d.error_message=!0,d.setStatus("I dati inseriti non sono corretti, riprova")):(d.error_message=!0,d.setStatus("Qualcosa \u00e8 andato storto, riprova"));$("html, body").animate({scrollTop:0},"fast")})};this.updatePlays=function(){c.loadPlaysByDate()};
e.$on("selectRepeatEnd",function(a,b,d){setTimeout(function(){$("select").material_select()},50)});this.setStatus=function(a){d.setStatusClass();d.status=a};this.setStatusClass=function(){d.error_message?($("#plays_message").removeClass("green-text white-text"),$("#plays_message").addClass("red-text")):($("#plays_message").removeClass("red-text white-text"),$("#plays_message").addClass("green-text"))};this.loadFilms()}]).controller("AdminPlaysController",["$rootScope","$location","Plays","Rooms",
"Films",function(a,c,e,b,f){var d=this;this.loading=!0;this.status="";this.error_message=!1;this.currentPlay={};this.currentSelectedPlay=this.currentSelectedFilm=this.currentSelectedDate=-1;this.shared_obj={};this.films=[];this.mapLoaded=!0;this.loadFilms=function(){f.query(function(a){d.films=a},function(){d.error_message=!0;d.setStatus("Errore durante il caricamento dei film")})};this.setCurrentPlay=function(a,c,f){d.mapLoaded=!1;d.currentPlay=d.playGenerator(a,c,f);d.currentSelectedDate=a;d.currentSelectedFilm=
c;d.currentSelectedPlay=f;b.getRoomStatus(d.currentPlay.pid).success(function(a){d.shared_obj.editable=!1;d.shared_obj.mapTheatre=a.seats;d.mapLoaded=!0}).error(function(a,b){d.shared_obj.editable=!1;d.shared_obj.mapTheatre=[];d.error_message=!0;d.setStatus("Errore durante il caricamento della mappa");$("html, body").animate({scrollTop:0},"fast");d.mapLoaded=!0})};this.deletePlay=function(){e["delete"]({id:d.currentPlay.pid}).$promise.then(function(){d.updatePlays();d.close_delete_modal();d.error_message=
!1;d.setStatus("Proiezione cancellata con successo");$("html, body").animate({scrollTop:0},"fast")},function(a){409==a.status?(d.error_message=!0,d.setStatus("Impossibile cancellare la proiezione, alcuni posti sono gi\u00e0 prenotati")):(d.error_message=!0,d.setStatus("Si \u00e8 verificato un errore, riprova"));d.close_delete_modal();$("html, body").animate({scrollTop:0},"fast")})};this.open_delete_modal=function(a,b,c){d.setCurrentPlay(a,b,c);$("#modal_deleteAgree").openModal()};this.close_delete_modal=
function(){$("#modal_deleteAgree").closeModal()};this.playGenerator=function(b,c,d){b=a.cloneObject(a.playsByDate[b].films[c]);b.pid=b.plays[d].pid;b.rid=b.plays[d].rid;b.free=b.plays[d].free;b.time=new Date(b.plays[d].time);delete b.date;delete b.plays;return b};this.updatePlays=function(){a.loadPlaysByDate()};this.setStatus=function(a){d.setStatusClass();d.status=a};this.setStatusClass=function(){d.error_message?($("#plays_message").removeClass("green-text white-text"),$("#plays_message").addClass("red-text")):
($("#plays_message").removeClass("red-text white-text"),$("#plays_message").addClass("green-text"))};d.loadFilms()}])})();(function(){angular.module("adminPrices",["pricesModule"]).controller("AdminPricesController",["$location","$rootScope","Prices",function(a,c,e){var b=this;this.error_msg="";this.newPrice={};this.tmpPrice={};this.prices=[];this.loadPrices=function(){e.getList().then(function(a){b.prices=a.data})};this.deletePrice=function(){e["delete"](b.tmpPrice).then(function(){b.loadPrices()},function(){})};this.addPrice=function(){e.save(b.newPrice).then(function(){b.newPrice={};b.loadPrices()},function(){})};
this.open_delete_modal=function(a){b.tmpPrice=a;$("#modal_price_delete").openModal()};this.close_delete_modal=function(){$("#modal_price_delete").closeModal()};this.open_edit_modal=function(a){b.tmpPrice=c.cloneObject(a);$("#modal_price_edit").openModal()};this.close_edit_modal=function(){$("#modal_price_edit").closeModal()};this.editPrice=function(a){b.error_msg="";e.update(a).then(function(a){b.tmpPrice={};b.loadPrices();b.close_edit_modal()},function(){b.error_msg="Modifica fallita."})};this.loadPrices()}])})();(function(){angular.module("adminRooms",["filmsPlaysModule"]).controller("AdminNewRoomController",["$rootScope","$location","Rooms","Theatre",function(a,c,e,b){var f=this;this.newRoom=new b;this.shared_obj={};this.matrix=[];this.hiddenSeats=[];this.error_msg="";this.createMatrix=function(a,b){for(var c=0;c<a;c++){f.matrix[c]=[];for(var e=0;e<b;e++)f.matrix[c][e]=1}};this.generateMap=function(){f.createMatrix(f.newRoom.rows,f.newRoom.columns);f.newRoom.seats=f.matrix;f.matrix=[];f.shared_obj.editable=
!0;f.shared_obj.selected_seats=[];f.shared_obj.mapTheatre=f.newRoom.seats};this.sendMap=function(){$(".room-loader").addClass("active");f.error_msg="";f.hiddenSeats=f.shared_obj.selected_seats;if(void 0!=f.hiddenSeats){for(var a=0;a<f.hiddenSeats.length;a++){var b=parseInt(f.hiddenSeats[a].row),e=parseInt(f.hiddenSeats[a].col);f.newRoom.seats[b][e]=0}void 0!=f.newRoom.seats.length&&void 0!=f.newRoom.seats[0].length&&(f.newRoom.rows=f.newRoom.seats.length,f.newRoom.columns=f.newRoom.seats[0].length);
f.newRoom.$save(function(a){$(".room-loader").removeClass("active");c.path("/admin/rooms")},function(){$(".room-loader").removeClass("active");f.error_msg="Aggiunta della nuova sala fallita."})}else $(".room-loader").removeClass("active"),f.error_msg="Ricontrolla i dati inseriti."}}]).controller("AdminEditRoomController",["$rootScope","$routeParams","$location","Rooms","Theatre",function(a,c,e,b,f){var d=this;this.rid=c.rid;this.cols=this.rows=0;this.matrix=[[]];this.shared_obj={};this.hiddenSeats=
[];this.error_msg="";this.mapLoaded=!1;this.getRoomMap=function(){d.mapLoaded=!1;d.error_msg="";b.getRoomEditableByID(d.rid).success(function(a){d.matrix=a.seats;d.rows=d.matrix.length;d.cols=d.matrix[0].length;d.generateMap();d.mapLoaded=!0}).error(function(){d.error_msg="Non \u00e8 stato possibile scaricare la mappa dal server.";d.mapLoaded=!0})};this.generateMap=function(){d.shared_obj.editable=!0;d.shared_obj.selected_seats=[];d.shared_obj.mapTheatre=d.matrix};this.sendMap=function(){d.error_msg=
"";var a=d.matrix.length,c=d.matrix[0].length;$(".room-loader").addClass("active");d.hiddenSeats=d.shared_obj.selected_seats;d.matrix=d.createMatrix(a,c);for(var f=0;f<d.hiddenSeats.length;f++){var n=parseInt(d.hiddenSeats[f].row),k=parseInt(d.hiddenSeats[f].col);d.matrix[n][k]=0}b.editRoom(d.rid,{rows:a,columns:c,seats:d.matrix}).success(function(){$(".room-loader").removeClass("active");e.path("/admin/rooms")}).error(function(a){$(".room-loader").removeClass("active");d.error_msg=409==a?"Si sta cercando di modificare posti gi\u00e0 prenotati.":
"Modifica della sala fallita."})};this.createMatrix=function(a,b){for(var c=[],d=0;d<a;d++){c[d]=[];for(var f=0;f<b;f++)c[d][f]=1}return c};d.getRoomMap()}]).controller("AdminRoomsController",["$rootScope","$location","Rooms",function(a,c,e){var b=this;this.currentRoom={};this.newRoom={};this.newRoom.seats=[b.newRoom.rows][b.newRoom.columns];this.rooms=[];this.currentSelected=-1;this.shared_obj={};this.error="";this.mapLoaded=!0;this.loadRooms=function(){b.rooms=[];e.getRoomsOnly().success(function(a){b.rooms=
a}).error(function(a){b.error="Sale non caricate."})};this.setCurrentRoom=function(a){b.mapLoaded=!1;b.currentRoom=b.rooms[a];b.currentSelected=a;e.getRoomTopByID(b.currentRoom.rid).success(function(a){b.shared_obj.editable=!1;b.shared_obj.mapTheatre=a.seats;b.mapLoaded=!0}).error(function(a){b.shared_obj.editable=!1;b.shared_obj.mapTheatre=[];b.mapLoaded=!0})};this.loadRooms()}])})();(function(){angular.module("adminStats",["statsModule"]).controller("AdminStatsController",["$location","Films","Stats",function(a,c,e){var b=this;this.error="";var f={labels:[],datasets:[{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[]}]};this.topUsers=function(){e.topUsers().success(function(a){b.error="";for(var c in a)void 0!=a[c].spent&&(f.labels.push(a[c].firstName+" "+a[c].secondName),
f.datasets[0].data.push(a[c].spent));a=$("#topClients").get(0).getContext("2d");(new Chart(a)).Bar(f,{pointDot:!1})}).error(function(a){b.error="Il caricamento dei dati \u00e8 fallito."})};var d=[];this.filmsIncome=function(){e.grossingFilms().success(function(a){var c=["#E52323","#1C82AF","#E8C800","#464646","#1BB21B"];b.error="";for(var f in a)void 0!=a[f].grossing&&d.push({label:a[f].title,value:a[f].grossing,color:c[a.indexOf(a[f])%c.length]});a=$("#filmsIncome").get(0).getContext("2d");(new Chart(a)).Doughnut(d,
{animateScale:!0})}).error(function(a){b.error="Errore in parse dati film income"})};this.filmsIncome();this.topUsers()}])})();(function(){angular.module("adminUsers",["usersModule"]).controller("AdminUsersEditController",["$routeParams","$location","Users",function(a,c,e){var b=this;this.currentUser={};this.status="";this.error_message=!1;e.get({id:a.uid}).$promise.then(function(a){b.currentUser=a},function(){c.path("/admin/users")});this.save=function(){e.update({id:b.currentUser.uid},b.currentUser).$promise.then(function(a){c.path("/admin/users")},function(a){409==a.status?(b.error_message=!0,b.setStatus("Email gi\u00e0 in uso")):
400==a.status?(b.error_message=!0,b.setStatus("I dati inseriti non sono validi")):(b.error_message=!0,b.setStatus("Qualcosa \u00e8 andato storto, riprova"))})};this.setStatus=function(a){b.setStatusClass();b.status=a};this.setStatusClass=function(){b.error_message?($("#user_edit_message").removeClass("green-text white-text"),$("#user_edit_message").addClass("red-text")):($("#user_edit_message").removeClass("red-text white-text"),$("#user_edit_message").addClass("green-text"))}}]).controller("AdminUserBookingsController",
["$routeParams","$scope","$location","$anchorScroll","Users","Auth",function(a,c,e,b,f,d){var g=this;this.bookings=[];this.uid=a.uid;this.currentTid=-1;this.status_msg="";this.intToChar=function(a){return String.fromCharCode("A".charCodeAt()+parseInt(a))};this.getBookings=function(){d.user_bookings(a.uid).success(function(a){g.bookings=a;for(a=0;a<g.bookings.length;a++){for(var b=g.bookings[a],c=0,d=0;d<b.tickets.length;d++)void 0!=b.tickets[d].price&&(c+=b.tickets[d].price);b.total=c}}).error(function(){})};
this.modifyTicketStatus=function(){g.status_msg="Un momento...";d.deleteTicket(g.currentTid).success(function(){g.status_msg="Modifica eseguita.";g.getBookings();b()}).error(function(){g.status_msg="Modifica fallita.";g.getBookings();b()});g.close_delete_modal()};this.open_modal_confirm=function(a,b){g.bookings[a].tickets[b].deleted||(g.currentTid=g.bookings[a].tickets[b].tid,$("#modal_delete_ticket_confirm").openModal())};this.close_delete_modal=function(){$("#modal_delete_ticket_confirm").closeModal()};
c.$on("collapsibleRepeatEnd",function(a,b,c){$(".collapsible").collapsible({accordion:!1})});g.getBookings()}]).controller("AdminUsersController",["$rootScope","$location","Users",function(a,c,e){var b=this;this.loading=!0;this.order="uid";this.reverse=!1;this.status="";this.error_message=!1;this.users=[];this.newUser=new e;this.newUser.enabled=!0;this.verifyPassword="";this.newUserRole=!1;this.currentUser={};this.tmpUser={};this.setOrder=function(a){this.order===a?this.reverse=!this.reverse:(this.reverse=
!1,this.order=a)};this.loadUsers=function(){b.loading=!0;b.users=[];e.query(function(a){b.users=a;b.loading=!1})};this.deleteUser=function(a){e["delete"]({id:a.uid},function(){b.users.splice(b.users.indexOf(a),1);b.error_message=!1;b.setStatus("Utente cancellato con successo");$("html, body").animate({scrollTop:0},"fast")},function(a){404==a.status?(b.error_message=!0,b.setStatus("Impossibile procedere alla cancellazione, utente non trovato")):(b.error_message=!0,b.setStatus("Qualcosa \u00e8 andato storto, riprova"));
$("html, body").animate({scrollTop:0},"fast")})};this.addUser=function(){b.verifyPassword==b.newUser.password?(b.newUser.role=b.newUserRole?"admin":"client",b.newUser.$save(function(a){b.users.push(a);b.newUser=new e;b.newUser.enabled=!0;c.path("/admin/users")},function(a){409==a.status?(b.error_message=!0,b.setStatus("Email gi\u00e0 in uso")):400==a.status?(b.error_message=!0,b.setStatus("Controlla i dati inseriti")):(b.error_message=!0,b.setStatus("Qualcosa \u00e8 andato storto, riprova"));$("html, body").animate({scrollTop:0},
"fast")})):(b.newUser.password="",b.verifyPassword="",this.open_wrong_password_modal(),$("#password").addClass("invalid"),$("#verifyPassword").addClass("invalid"))};this.open_user_delete_modal=function(a){this.tmpUser=this.users[a];$("#modal_user_delete").openModal()};this.close_user_delete_modal=function(){$("#modal_user_delete").closeModal()};this.open_wrong_password_modal=function(){$("#modal_wrong_password").openModal()};this.close_wrong_password_modal=function(){$("#modal_wrong_password").closeModal();
$("#password").focus()};this.setStatus=function(a){b.setStatusClass();b.status=a};this.setStatusClass=function(){b.error_message?($("#user_message").removeClass("green-text white-text"),$("#user_message").addClass("red-text")):($("#user_message").removeClass("red-text white-text"),$("#user_message").addClass("green-text"))};this.loadUsers()}])})();(function(){angular.module("buyModule",["usersModule","storageModule","constantsModule"]).controller("BuySeatController",["$rootScope","$location","$anchorScroll","$window","BuyProcedure","Rooms",function(a,c,e,b,f,d){function g(a){switch(a){case 1:h.error="Sembra che tu sia cercando di acquistare proiezioni o biglietti non pi\u00f9 disponibili. Per favore, ricontrolla il carrello.";break;case 2:h.error=""}}var h=this;this.go=!1;this.error="";this.mapLoaded=!1;a.buy.shared_obj.selected_seats=[];a.buy.shared_obj.film=
{};this.start_buy=function(){a.buy.shared_obj.film={};a.buy.shared_obj.selected_seats=[];a.buy.data_to_server=[];a.buy.data_to_server.cart=[];a.buy.data_from_server_index=-1;$(".buy-seats-loader").addClass("active");g(2);h.go=!1;a.isUserLogged?(a.afterLogin="normal",f.proceed(a.cart).success(function(){$(".buy-seats-loader").removeClass("active");g(2);a.buy.data_from_server=a.cloneObject(a.cart);h.go=!0;h.next_buy()}).error(function(b){a.cart=b;$(".buy-seats-loader").removeClass("active");h.go=!1;
g(1);c.path("/buy_start_error")})):($(".buy-seats-loader").removeClass("active"),a.afterLogin="buy",c.path("/login"))};this.next_buy=function(){a.buy.shared_obj.selected_seats=[];a.buy.data_from_server_index++;if(a.buy.data_from_server_index<a.buy.data_from_server.length){h.mapLoaded=!1;h.seats_msg="";a.buy.shared_obj.film=a.buy.data_from_server[a.buy.data_from_server_index];for(var b=a.buy.shared_obj.film.seats_selected=0;b<a.buy.shared_obj.film.tickets.length;b++)a.buy.shared_obj.film.seats_selected+=
a.buy.shared_obj.film.tickets[b].number;d.getRoomStatus(a.buy.shared_obj.film.pid).success(function(b){a.buy.shared_obj.selected_seats=[];a.buy.shared_obj.film.seats=b.seats;h.mapLoaded=!0}).error(function(){h.mapLoaded=!0;c.path("/error")});$(".buy-loader").removeClass("active");e()}else $(".buy-loader").removeClass("active"),e(),c.path("/buy_last_step")};this.save_seats=function(){0<a.buy.shared_obj.film.seats_selected?h.seats_msg="Devi ancora selezionare i posti rimanenti":($(".buy-loader").addClass("active"),
h.ff=a.cloneObject(a.buy.shared_obj.film),h.ff.selected_seats=a.cloneObject(a.buy.shared_obj.selected_seats),delete h.ff.seats,delete h.ff.seats_selected,a.buy.data_to_server.cart.push(h.ff),this.next_buy())};this.open_modal=function(){$("#modal_buy_cancel").openModal()};this.close_modal=function(){$("#modal_buy_cancel").closeModal()};this.cancel_procedure=function(){a.buy.shared_obj.film={};a.buy.shared_obj.selected_seats=[];a.buy.data_to_server.cart=[];a.buy.data_from_server=[];a.buy.data_from_server_index=
-1;this.close_modal();c.path("/today")};this.start_buy()}]).controller("BuySummaryController",["$rootScope","$location","BuyProcedure",function(a,c,e){var b=this;this.cd={number:"",month:1,year:2015,cvv:"",name:""};this.importToPay=0;this.error_msg="";this.ERROR_CARD="I dati inseriti sembrano non essere validi. Controlla.";this.pay=function(){$(".buy-loader").addClass("active");b.error_msg="";for(var f=0;f<a.buy.data_to_server.cart.length;f++)for(var d=0;d<a.buy.data_to_server.cart[f].selected_seats.length;d++){var g=
a.buy.data_to_server.cart[f].selected_seats[d],h=parseInt(g.row),g=parseInt(g.col);a.buy.data_to_server.cart[f].selected_seats[d]={row:h,col:g}}e.pay(b.cd,a.buy.data_to_server.cart).success(function(){$(".buy-loader").removeClass("active");a.buy.complete_error=!1;a.cart=[];a.buy.data_to_server={};c.path("/buy_complete")}).error(function(d,e){400==e?(b.error_msg=b.ERROR_CARD,$(".buy-loader").removeClass("active")):409==e&&(a.cart=[],a.cart=d,$(".buy-loader").removeClass("active"),a.buy.complete_error=
!0,c.path("/buy_complete"))})};this.open_modal=function(){$("#modal_buy_cancel").openModal()};this.close_modal=function(){$("#modal_buy_cancel").closeModal()};this.cancel_procedure=function(){a.buy.shared_obj.film={};a.buy.shared_obj.selected_seats=[];a.buy.data_to_server={};a.buy.data_from_server=[];a.buy.data_from_server_index=-1;this.close_modal();c.path("/today")};this.calcImportAndPrices=function(){var c=a.user.credit,d=a.buy.data_to_server.cart,e=-1;if(void 0!=d)for(var h=e=0;h<d.length;h++)for(var t=
0;t<a.tickets.length;t++){for(var n=0,k=0;k<d[h].tickets.length;k++)d[h].tickets[k].type==a.tickets[t].type&&(n+=d[h].tickets[k].number,d[h].tickets[k].price=a.tickets[t].price*d[h].tickets[k].number);e+=a.tickets[t].price*n}b.importToPay=void 0!=c?e>c?e-c:0:e};b.calcImportAndPrices()}]).controller("BuyCompleteController",["$rootScope",function(a){this.BUY_COMPLETE_SUCCESS="Il pagamento \u00e8 andato a buon fine. Grazie per aver acquistato sul nostro sito! A breve riceverai i biglietti direttamente nella tua casella di posta.";
this.BUY_COMPLETE_ERROR="Oh oh... Sembra che qualcuno abbia gi\u00e0 prenotato i posti che hai selezionato o hai impiegato troppo a completare la procedura d'acquisto. Ti invitiamo a riprovare.";this.buy_complete_msg="";this.setCompleteMsg=function(a){$(".buy-complete-msg").removeClass("white-text red-text");a?($(".buy-complete-msg").addClass("red-text"),this.buy_complete_msg=this.BUY_COMPLETE_ERROR):($(".buy-complete-msg").addClass("white-text"),this.buy_complete_msg=this.BUY_COMPLETE_SUCCESS)};
this.setCompleteMsg(a.buy.complete_error)}])})();(function(){angular.module("cartModule",["pricesModule"]).controller("CartController",["$rootScope","Prices","$location",function(a,c,e){function b(){setTimeout(function(){$(".cart-icon").css({"-webkit-animation":"","-moz-animation":"","-o-animation":"",animation:""})},1650);$(".cart-icon").css({"-webkit-animation":"cart-animation 0.3s 5.5","-moz-animation":"cart-animation 0.3s 5.5","-o-animation":"cart-animation 0.3s 5.5",animation:"cart-animation 0.3s 5.5"})}this.addToCart=function(c,d){for(var e=
!1,h=0;h<a.cart.length;h++)c.plays[d].pid==a.cart[h].pid&&(e=!0,h=a.cart.length);e||(e=a.cloneObject(c),e.tickets=[],e.tickets.push({type:a.tickets[0].type,number:1}),e.time=c.plays[d].time,e.pid=c.plays[d].pid,e.rid=c.plays[d].rid,e.free=c.plays[d].free,e._3d=c.plays[d]._3d,delete e.date,delete e.plays,delete e.genre,delete e.trailer,delete e.plot,delete e.duration,a.cart.push(e),b())};this.removeFromCart=function(b){a.cart.splice(b,1)};this.addDropDown=function(b){a.cart[b].tickets.length<a.tickets.length&&
a.cart[b].tickets.push({type:a.tickets[0].type,number:1})};this.removeDropDown=function(b,c){a.cart[b].tickets.splice(c,1)};this.proceed=function(){e.path("/buy")}}])})();(function(){angular.module("confirmModule",["usersModule"]).controller("ConfirmController",["$location","Auth",function(a,c){var e=this;this.loading=!0;this.status="";(function(){var b=a.search().c;void 0==b?(e.loading=!1,e.status="Link non pi\u00f9 valido o gi\u00e0 usato."):c.confirmRegistration(b).then(function(){e.loading=!1;e.status="Account confermato. Ora puoi acquistare biglietti!"},function(){e.loading=!1;e.status="Link non pi\u00f9 valido o gi\u00e0 usato."})})()}])})();(function(){function a(a){var e=a.indexOf("@"),b=a.lastIndexOf(".");return 1>e||b<e+2||b+2>=a.length?!1:!0}angular.module("loginModule",["usersModule","constantsModule"]).controller("LoginController",["$rootScope","$location","Auth",function(c,e,b){var f=this;this.pass=this.email="";this.login=function(a,g){$(".login-loader").addClass("active");c.isUserLoggedPromise=b.login(a,g).then(function(a){c.loginError="";c.user=a;c.isUserLogged=!0;switch(c.afterLogin){case "normal":f.setAfterLogin("normal");
"admin"==c.user.role?e.path("/admin"):e.path("/today");break;case "buy":f.setAfterLogin("normal");e.path("/buy");break;case "userArea":f.setAfterLogin("normal"),"admin"==c.user.role?e.path("/admin"):e.path("/me")}$(".login-loader").removeClass("active")},function(a){c.isUserLogged=!1;c.loginError="Nome utente o password errati.";$(".login-loader").removeClass("active")});f.pass=""};this.logout=function(){b.logout().success(function(){c.loginError="";c.isUserLogged=!1;c.isUserLoggedPromise=void 0;
c.user={};f.email="";f.pass="";e.path("/today")}).error(function(){c.loginError="";c.isUserLogged=!1;c.isUserLoggedPromise=void 0;c.user={};f.email="";f.pass="";e.path("/today")})};this.setAfterLogin=function(a){c.afterLogin=a};this.losePass=function(){e.path("/password_recovery")};this.toUserArea=function(){e.path("/me")};this.toDashboard=function(){e.path("/admin")};this.toRegister=function(){e.path("/registration")};this.mailForPassRecovery=this.rec_pass_msg="";this.sendPassRecoveryRequest=function(){$(".pass-rec-loader").addClass("active");
$("#pass_recovery_message").removeClass("green-text red-text");$("#pass_recovery_message").addClass("white-text");f.rec_pass_msg="Un momento...";void 0!=this.mailForPassRecovery&&a(this.mailForPassRecovery)?b.forgotPassword(f.mailForPassRecovery).success(function(){f.set_rec_pass_msg(0);$(".pass-rec-loader").removeClass("active")}).error(function(){f.set_rec_pass_msg(1);$(".pass-rec-loader").removeClass("active")}):(f.set_rec_pass_msg(2),$(".pass-rec-loader").removeClass("active"))};this.set_rec_pass_msg=
function(a){$("#pass_recovery_message").removeClass("white-text");0==a?($("#pass_recovery_message").addClass("green-text"),f.rec_pass_msg="Richiesta effettuata. Controlla la tua casella di posta."):1==a?($("#pass_recovery_message").addClass("red-text"),f.rec_pass_msg="L'indirizzo mail inserito non risulta registrato. Riprova."):2==a?($("#pass_recovery_message").addClass("red-text"),f.rec_pass_msg="L'indirizzo mail inserito non \u00e8 corretto. Riprova."):($("#pass_recovery_message").addClass("red-text"),
f.rec_pass_msg="La richiesta non \u00e8 andata a buon fine. Riprova.")}}])})();(function(){angular.module("meModule",["usersModule"]).controller("MeController",["$rootScope","$scope","$timeout","$location","Auth",function(a,c,e,b,f){var d=this;this.loading=!0;this.bookings=[];this.passTrigger=!1;this.result=this.verifyPass=this.newPass=this.oldPass="";this.passBtn="Cambia Password";this.pass=function(){d.passTrigger?d.newPass==d.verifyPass?f.changePassword(a.user.email,d.oldPass,d.newPass).success(function(){d.result="Password cambiata con successo.";d.passBtn="Cambia Password";
d.passTrigger=!1}).error(function(){d.result="La richiesta non \u00e8 andata a buon fine. Ricontrolla i dati."}):d.result="Le due password inserite non coincidono.":(d.passTrigger=!0,d.passBtn="Cambia")};this.loadUserBookings=function(){f.my_bookings().success(function(a){d.bookings=a;for(a=0;a<d.bookings.length;a++){for(var b=d.bookings[a],c=0,e=0;e<b.tickets.length;e++)void 0!=b.tickets[e].price&&(c+=b.tickets[e].price);b.total=c}d.loading=!1}).error(function(){d.loading=!1})};c.$on("collapsibleRepeatEnd",
function(a,b,c){$(".collapsible").collapsible({accordion:!1})});this.intToChar=function(a){return String.fromCharCode("A".charCodeAt()+parseInt(a))};e(this.loadUserBookings,1E3)}])})();(function(){angular.module("PlaysModule",["filmsPlaysModule"]).controller("PlaysController",["$rootScope","$scope",function(a,c){this.current={};this.show_trailer_for_current="Trailer";this.isNow=function(a){return!0};this.setCurrent=function(c,b){this.current=a.playsByDate[c].films[b];$("#modal").openModal()};this.closeWindow=function(){$("#modal").closeModal()};this.showTrailer=function(){this.show_trailer_for_current="Trailer"==this.show_trailer_for_current?"Locandina":"Trailer"};c.$on("dropdownRepeatEnd",
function(a,b,c){$(".dropdown-button").dropdown()});c.$on("tooltipRepeatEnd",function(a,b,c){window.matchMedia("(min-width: 992px)").matches&&$(".tooltipped").tooltip({delay:50})})}])})();(function(){angular.module("registrationModule",["usersModule"]).controller("RegistrationCtrl",["Auth",function(a){var c=this;this.status="";this.user={};this.verifyPassword="";this.submit=function(e){$(".registration-loader").addClass("active");$("#registration_message").removeClass("red-text green-text");$("#registration_message").addClass("white-text");c.status="Un momento...";c.verifyPassword==c.user.password?a.registration(e.email,e.password,e.firstName,e.secondName).success(function(a){$("#registration_message").removeClass("red-text white-text");
$("#registration_message").addClass("green-text");c.status="La richiesta \u00e8 stata inoltrata. Controlla la tua casella di posta.";$(".registration-loader").removeClass("active")}).error(function(a,e){$("#registration_message").removeClass("green-text white-text");$("#registration_message").addClass("red-text");c.status=409==e?"La mail \u00e8 gi\u00e0 stata utilizzata. Si prega di cambiarla.":"La richiesta non \u00e8 andata a buon fine. Ricontrolla i dati inseriti.";$(".registration-loader").removeClass("active")}):
($("#registration_message").removeClass("green-text white-text"),$("#registration_message").addClass("red-text"),c.user.password="",c.verifyPassword="",$("#password").addClass("invalid"),$("#password").focus(),$("#verifyPassword").addClass("invalid"),c.status="Le password inserite non coincidono, riprova.",$(".registration-loader").removeClass("active"))}}])})();(function(){angular.module("resetModule",["usersModule"]).controller("ResetController",["$location","Auth",function(a,c){var e=this;this.verifyPassword=this.password=this.email=this.status="";this.submit=function(){var b=a.search().r;void 0==b?(e.loading=!1,e.status="Link non pi\u00f9 valido."):e.verifyPassword==e.password?c.changePasswordWithCode(e.email,b,e.password).then(function(){e.loading=!1;e.status="Richiesta riuscita. Usa la nuova password per entrare nel tuo account."},function(){e.loading=
!1;e.status="La richiesta non \u00e8 andata a buon fine. Ricontrolla i dati o, se il problema persiste, ricomincia la procedura di recupero."}):this.status="Le due password inserite non coincidono."}}])})();(function(){angular.module("tabmodule",[]).controller("TabController",function(){this.tab=-1;this.setTab=function(a){this.tab==a?($(".side-div").removeClass("side-div-w"),this.tab=-1):-1==a?($(".side-div").removeClass("side-div-w"),this.tab=-1):($(".side-div").addClass("side-div-w"),this.tab=a)};this.closeTab=function(){this.setTab(-1)};this.isSet=function(a){return this.tab===a}})})();(function(){$(document).ready(function(){$(".button-collapse").sideNav({closeOnClick:!0});$("select").material_select();$(".modal-trigger").leanModal({dismissible:!0,opacity:.5,in_duration:400,out_duration:300});var a=$("#fab_primary"),c=$(".fixed-button a i");a.click(function(){a.hasClass("active")?(a.toggleClass("active"),$(".fixed-list").removeClass("slideInUp"),$(".fixed-list").addClass("slideOutDown"),c.removeClass("rotateOut"),c.addClass("rotateIn")):($(".fixed-list").removeClass("hide-list"),
a.toggleClass("active"),$(".fixed-list").removeClass("slideOutDown"),$(".fixed-list").addClass("slideInUp"),c.removeClass("rotateIn"),c.addClass("rotateOut"))})})})();
(function(){angular.module("cineweb","ngRoute uiGmapgoogle-maps cartModule PlaysModule tabmodule loginModule roomsModule registrationModule meModule adminDashboard adminUsers adminFilms adminPrices adminPlays adminRooms adminStats confirmModule resetModule buyModule pricesModule mapModule buyProcedureModule".split(" ")).config(["$routeProvider",function(a){var c=function(a,b,c){void 0!=a.isUserLoggedPromise?a.isUserLoggedPromise.then(function(a){void 0!=a&&"admin"!=a.role&&"/me"!=b.path()&&b.path("/error")},
function(){b.path("/login")}):c.me().then(function(){a.isUserLogged=!0;a.user=data;"admin"!=data.role&&"/me"!=b.path()&&b.path("/error")},function(){a.isUserLogged=!1;a.user={};b.path("/login")})};a.when("/",{redirectTo:"/today"}).when("/home",{redirectTo:"/today"}).when("/today",{templateUrl:"../partials/today.html",controller:"PlaysController",controllerAs:"ctrl"}).when("/info",{templateUrl:"../partials/info.html"}).when("/cart_mobile",{templateUrl:"../partials/cart_mobile.html",controller:"CartController",
controllerAs:"cc"}).when("/login_mobile",{templateUrl:"../partials/login_mobile.html",controller:"LoginController",controllerAs:"c"}).when("/registration",{templateUrl:"../partials/registration.html",controller:"RegistrationCtrl",controllerAs:"ctrl"}).when("/password_recovery",{templateUrl:"../partials/password_recovery.html",controller:"LoginController",controllerAs:"c"}).when("/me",{templateUrl:"../partials/me.html",controller:"MeController",controllerAs:"ctrl",resolve:{factory:c}}).when("/login",
{templateUrl:"../partials/login.html",controller:"LoginController",controllerAs:"c"}).when("/confirm",{templateUrl:"../partials/confirm.html",controller:"ConfirmController",controllerAs:"ctrl"}).when("/reset",{templateUrl:"../partials/reset.html",controller:"ResetController",controllerAs:"ctrl"}).when("/admin",{templateUrl:"../partials/admin/dashboard.html",controller:"AdminDashboardController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/films",{templateUrl:"../partials/admin/films.html",
controller:"AdminFilmsController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/films/new",{templateUrl:"../partials/admin/new_film.html",controller:"AdminFilmsController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/films/:fid",{templateUrl:"../partials/admin/edit_film.html",controller:"AdminFilmsEditController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/plays",{templateUrl:"../partials/admin/plays.html",controller:"AdminPlaysController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/plays/new",
{templateUrl:"../partials/admin/new_play.html",controller:"AdminNewPlaysController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/plays/:pid",{templateUrl:"../partials/admin/edit_play.html",controller:"AdminPlaysEditController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/prices",{templateUrl:"../partials/admin/prices.html",controller:"AdminPricesController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/rooms",{templateUrl:"../partials/admin/rooms.html",controller:"AdminRoomsController",
controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/rooms/new_room",{templateUrl:"../partials/admin/new_room.html",controller:"AdminNewRoomController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/rooms/edit_room/:rid",{templateUrl:"../partials/admin/edit_room.html",controller:"AdminEditRoomController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/stats",{templateUrl:"../partials/admin/stats.html",controller:"AdminStatsController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/users",
{templateUrl:"../partials/admin/users.html",controller:"AdminUsersController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/users/new",{templateUrl:"../partials/admin/new_user.html",controller:"AdminUsersController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/users/:uid",{templateUrl:"../partials/admin/edit_user.html",controller:"AdminUsersEditController",controllerAs:"ctrl",resolve:{factory:c}}).when("/admin/users/bookings/:uid",{templateUrl:"../partials/admin/user_bookings.html",
controller:"AdminUserBookingsController",controllerAs:"ctrl",resolve:{factory:c}}).when("/buy",{templateUrl:"../partials/buy_seats.html",controller:"BuySeatController",controllerAs:"ctrl"}).when("/buy_start_error",{templateUrl:"../partials/buy_seats_error.html"}).when("/buy_last_step",{templateUrl:"../partials/buy_summary.html",controller:"BuySummaryController",controllerAs:"ctrl"}).when("/buy_complete",{templateUrl:"../partials/buy_complete.html",controller:"BuyCompleteController",controllerAs:"ctrl"}).when("/error",
{templateUrl:"../partials/error.html"}).when("/popcorn",{templateUrl:"../partials/popcorn.html"}).otherwise({redirectTo:"/error"})}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({v:"3.17",libraries:"weather,geometry,visualization"})}]).directive("loading",function(){return{restrict:"E",templateUrl:"../partials/directives/loading.html",scope:{loading:"=loading"}}}).directive("onDropdownRepeat",function(){return function(a,c,e){a.$last&&a.$emit("dropdownRepeatEnd",c,e)}}).directive("onCollapsibleRepeat",
function(){return function(a,c,e){a.$last&&a.$emit("collapsibleRepeatEnd",c,e)}}).directive("onSelectRepeat",function(){return function(a,c,e){a.$last&&a.$emit("selectRepeatEnd",c,e)}}).directive("onTooltipRepeat",function(){return function(a,c,e){a.$last&&a.$emit("tooltipRepeatEnd",c,e)}}).run(["$rootScope","$location","$anchorScroll","$q","Prices","StorageService","Auth","CompletePlays","$sce","BuyProcedure",function(a,c,e,b,f,d,g,h,t,n){a.$on("$routeChangeStart",function(a,b){void 0!=c.search().c&&
"/confirm"!=c.path()&&c.path("/confirm");void 0!=c.search().r&&"/reset"!=c.path()&&c.path("/reset")});a.$on("$routeChangeSuccess",function(){e()});a.cloneObject=function(a){return JSON.parse(JSON.stringify(a))};a.trustSrcTrailerUrl=function(a){void 0!=a&&(a=a.replace("watch?v=","embed/"));return t.trustAsResourceUrl(a)};a.updateTotal=function(){for(var b=a.total=0;b<a.cart.length;b++)for(var c=0;c<a.tickets.length;c++){for(var d=0,e=0;e<a.cart[b].tickets.length;e++)a.cart[b].tickets[e].type==a.tickets[c].type&&
(d+=a.cart[b].tickets[e].number);a.total+=a.tickets[c].price*d}};a.user={};a.isUserLogged=!1;a.isUserLoggedPromise=g.me();a.loginError="";a.afterLogin="normal";(function(){a.isUserLoggedPromise.then(function(b){a.isUserLogged=!0;a.user=b},function(b){a.isUserLogged=!1;a.user={}})})();a.loadPrices=function(){f.getList().then(function(b){a.tickets=b.data;a.updateTotal()})};a.tickets=[];a.loadPrices();a.loadPlaysByDate=function(){h.playsByDate().then(function(b){a.playsByDate=b},function(b){a.playsByDate=
[];c.path("/error")})};a.loadPlaysByDate();a.cart=a.cart||[];a.total=a.total||0;(function(){a.cart=d.loadCart();null==a.cart&&(a.cart=[]);n.proceed(a.cart).success(function(){}).error(function(b,c){a.cart=409==c?b:[]})})();a.$watch(function(){return a.cart},function(b){a.updateTotal();d.saveCart(b)},!0);a.cartLength=function(){return a.cart.length};a.buy={shared_obj:{},data_from_server:[],data_from_server_index:-1,data_to_server:{},complete_error:!0};a.buy.data_to_server.cart=[]}])})();
